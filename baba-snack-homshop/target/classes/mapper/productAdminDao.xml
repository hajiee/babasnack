<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.babasnack.demo.product.dao.ProductAdminDao">
    <!-- 상품 등록 -->
	<insert id="addProduct" parameterType="com.babasnack.demo.product.dto.ProductDto.WriteP">
    	<selectKey keyProperty="pno" resultType="long" order="AFTER">
        	select product_seq.nextval from dual
    	</selectKey>
    	insert into product(pno, product_name, product_notice, product_stock, product_price, product_size, category)
   		values (#{pno}, #{productName}, #{productNotice}, #{productStock}, #{productPrice}, #{productSize}, #{category.name()})
	</insert>

    <!-- 상품 수정 -->
    <update id="updateProduct" parameterType="com.babasnack.demo.product.dto.ProductDto.WriteP">
        update product
        set product_name = #{productName},
            product_notice = #{productNotice},
            product_stock = #{productStock},
            product_price = #{productPrice},
            product_size = #{productSize},
            category = #{category.name()}
        where pno = #{pno}
    </update>

    <!-- 상품번호로 조회 -->
    <select id="findByProduct" parameterType="long" resultType="com.babasnack.demo.entity.Product">
        select * from product
        where pno = #{pno}
    </select>

    <!-- 주어진 상품 번호(pno)에 해당하는 모든 사진들을 조회 -->
    <select id="findProductPhotos" parameterType="long" resultType="java.lang.String">
        select product_save_img from product_photo
        where pno = #{pno}
    </select>

    <!-- 상품 삭제 -->
    <delete id="deleteProduct" parameterType="long">
        delete from product
        where pno = #{pno}
    </delete>

    <!-- 상품에 연관된 사진 삭제 -->
    <delete id="deleteAllPhotosByPNo" parameterType="long">
        delete from product_photo
        where pno = #{pno}
    </delete>
</mapper>
